<!DOCTYPE html>
<html>
<head>
    <title>Admin - Gropi detectate</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map { height: 90vh; }
        .popup-btn {
            margin-top: 5px;
            background-color: red;
            color: white;
            padding: 5px;
            border: none;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h2 style="text-align:center;">üõ†Ô∏è Admin - Gropi detectate</h2>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        const map = L.map('map').setView([46.77, 23.59], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        fetch("/api/points").then(res => res.json()).then(data => {
            data.forEach(point => {
                if (!point.location.lat || !point.location.lon) return;
                const marker = L.marker([point.location.lat, point.location.lon]).addTo(map);
                const content = `
                    <b>Status:</b> ${point.status}<br>
                    <img src="/static/uploads/${point.filename}" width="150"><br>
                    <button class="popup-btn" onclick="deletePoint('${point.id}')">»òterge</button>
                `;
                marker.bindPopup(content);
            });
        });

        function deletePoint(id) {
            fetch(`/api/delete/${id}`, { method: "POST" })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert("Punct »ôters!");
                        location.reload();
                    }
                });
        }
    </script>
</body>
</html>
